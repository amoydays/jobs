<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>现代码头作业预登记平台</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="no"/>
    <meta name="full-screen" content="no"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta content="false" id="twcClient" name="twcClient"/>
    <link rel="stylesheet" href="/css/style.css"/>
    <script src="/js/setfont.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/qrcode.js"></script>
</head>
<body>
<div class="searchw">
    <div class="searchTitle">现代码头作业预登记</div>
    <div class="searchcont">
        <div class="notice">
            <div class="rbox" th:if="${noticeIsShow == '1'}">
                <p th:text="|通知：${jobNotice.content}|" />
                <label>
                    <input type="radio" th:text="下次不再显示" onclick="noticeNoShow()" />
                </label>
            </div>
            <div class="rbox" th:if="${jobWarn.content}">
                <p th:text="|警示：${jobWarn.content}|" />
                <label>
                    <input type="radio" th:text="下次不再显示" th:onclick="warnNoShow([[${jobWarn.id }]])" />
                </label>
            </div>
        </div>
        <form method="post" id="form1">
            <input type="hidden" name="isAdd" value="true"/>
            <div class="inputs">
                <li>
                    <span>作业类型：</span>
                    <div class="rbox">
                        <label th:each="jobType,status:${jobTypeList}">
                            <input type="radio" name="typeId" th:value="${jobType.id }" th:checked="${status.count==1}"
                                   th:text="${jobType.name }"></input>
                        </label>
                    </div>
                </li>
                <li>
                    <span>作业货名：</span>
                    <div class="rbox">
                        <label th:each="jobGoods,status:${jobGoodsList}">
                            <input type="radio" name="goodsId" th:value="${jobGoods.id }"
                                   th:checked="${status.count==1}" th:text="${jobGoods.name }"></input>
                        </label>
                    </div>
                </li>
                <li>
                    <span>船名航次：</span>
                    <input type="text" placeholder="必填项，集港时可不填" name="vesselVoyage" id="vesselVoyage" th:value="${jobOrder.vesselVoyage}"/>
                </li>
                <!--                <li>-->
                <!--                    <span>作业区域：</span>-->
                <!--                    <div class="rbox">-->
                <!--                        <label th:each="jobArea,status:${jobAreaList}">-->
                <!--                            <input type="radio" name="areaId" th:value="${jobArea.id }" th:checked="${status.count==1}"-->
                <!--                                   th:text="${jobArea.name }"></input>-->
                <!--                        </label>-->
                <!--                    </div>-->
                <!--                </li>-->
                <li>
                    <span>作业时间：</span>
                    <div class="rbox">
                        <label><input type="radio" name="time" th:value="${today }+'夜班'" checked="true" th:text="|${today}夜班(18:30-07:00)|"></input></label>
                        <label><input type="radio" name="time" th:value="${tomorrow }+'白班'" th:text="|${tomorrow}白班(07:30-18:00)|"></input></label>
<!--                        <label><input type="radio" name="time" th:value="${tomorrow }+'夜班'"-->
<!--                                      th:text="|${tomorrow}夜班|"></input></label>-->
<!--                        <label><input type="radio" name="time" th:value="${tomorrowNext }+'白班'"-->
<!--                                      th:text="|${tomorrowNext}白班|"></input></label>-->
                    </div>
                </li>
                <li>
                    <span>作业单位：</span>
                    <input type="text" placeholder="必填项" name="driver" id="driver" th:value="${jobOrder.driver}"/>
                </li>
                <li>
                    <span>手机号码：</span>
                    <input type="text" placeholder="必填项" name="telephone" id="telephone"
                           th:value="${jobOrder.telephone}"/>
                </li>
                <li>
                    <span>作业件数：</span>
                    <input type="text" placeholder="件数、重量二选一" name="goodsNum" id="goodsNum"/>
                </li>
                <li>
                    <span>作业重量：</span>
                    <input type="text" placeholder="件数、重量二选一" name="weight" id="weight"/>
                </li>
                <div class="btn">
                    <input type="button" value="预登记" id="order"/>
                    <input type="reset" value="重置" id="orderReset"/>
                    <input type="button" value="查询和修改" onclick="gotoInfoPage()"/>
                </div>
            </div>
        </form>
    </div>
    <br/>
</div>

<script>
		function warnNoShow(id){
		    console.log(id);
			var params="id="+id+"&randon="+ new Date().getTime();
			$.ajax({
			    type: "get",
				url: "/warnNoShow",
				data:params,
				success: function(responseData, textStatus){
					alert('设置成功！');
				},
				error: function(){
					alert("网络传输出错,请再试一次！");
				}
			});
		}
		function noticeNoShow(){
			var params="randon="+ new Date().getTime();
			$.ajax({
			    type: "get",
				url: "/noticeNoShow",
				data:params,
				success: function(responseData, textStatus){
					alert('设置成功！');
				},
				error: function(){
					alert("网络传输出错,请再试一次！");
				}
			});
		}
		function gotoInfoPage(){
			window.location.href="/goOrderInfo";
		}

		$('#orderReset').on('click', function() {
			$('#jobOrderid').attr('value','');
			$('#driver').attr('value','');
			$('#telephone').attr('value','');
			$('#goodsNum').attr('value','');
			$('#weight').attr('value','');
			$('#vesselVoyage').attr('value','');
		})

		function cha(form) {
			if (form.vesselVoyage.value.match(/^\s*$/)) {
			    var val=$('input:radio[name="typeId"]:checked')[0].nextSibling.nodeValue;
			    //var val=$('input:radio[name="typeId"]:checked').val();
                if($.trim(val) != "集港"){
                    form.vesselVoyage.focus();
                    alert("船名航次 不能为空!");
                    return false;
                }
			}
			if (form.driver.value.match(/^\s*$/)) {
				form.driver.focus();
				alert("作业单位 不能为空!");
				return false;
			}
			if (form.telephone.value.match(/^\s*$/)) {
				form.telephone.focus();
				alert("手机号码 不能为空!");
				return false;
			}
			if (!form.telephone.value.match(/^[1][3-9][\d]{9}/)) {
				if (!form.telephone.value.match(/^(\({0,1}\d{3,4})\){0,1}(-){0,1}(\d{7,8})$/)) {
					form.telephone.focus();
					alert("请正确输入手机号码或者电话号码!");
					return false;
				}
			}
			if (form.goodsNum.value.match(/^\s*$/)) {
				if (form.weight.value.match(/^\s*$/)) {
					form.goodsNum.focus();
					alert("件数、重量至少输入一个!");
					return false;
				}
			}
			//件数不为空
			if (!form.goodsNum.value.match(/^\s*$/)) {
				if(!form.goodsNum.value.match(/^[1-9]\d*$/)){
					form.goodsNum.focus();
					alert("件数需为整数!");
					return false;
				}
			}
			//重量不为空
			if (!form.weight.value.match(/^\s*$/)) {
				if(!form.weight.value.match(/^[1-9]\d*$/)&&!form.weight.value.match(/^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$/)){
					form.weight.focus();
					alert("重量需为数字!");
					return false;
				}
			}

			return true;
		}
		$('#order').on('click', function() {
			if (true == cha(document.getElementById("form1"))) {
				document.getElementById("form1").action = "/orderAdd";
				document.getElementById("form1").submit();
			}
		})
</script>
</body>
</html>